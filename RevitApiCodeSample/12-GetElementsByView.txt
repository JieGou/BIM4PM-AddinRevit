doc = uidoc.Document;

//Get view id

 public FilteredElementCollector(
    Document document,
    ElementId viewId )

//Create collector to collect all elements on active view
FilteredElementCollector collector = new FilteredElementCollector(doc, doc.ActiveView.Id);

//get distinct categories of elements in the active view
var categories =
                collector                    
                    .ToElements()
                    .Select(x => x.Category)
                    .Distinct(new CategoryComparer())
                    .ToList();
